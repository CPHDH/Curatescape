/*
 * jQuery mmenu drag add-on
 * mmenu.frebsite.nl
 *
 * Copyright (c) Fred Heusschen
 */
!function(e){function n(e,n,t){return e<n&&(e=n),e>t&&(e=t),e}function t(t,o,s){var r,p,c,d=this,f={events:"panleft panright",typeLower:"x",typeUpper:"X",open_dir:"right",close_dir:"left",negative:!1},l="width",u=f.open_dir,m=function(e){e<=t.maxStartPos&&(v=1)},h=function(){return e("."+i.slideout)},v=0,g=0,w=0;switch(this.opts.offCanvas.position){case"top":case"bottom":f.events="panup pandown",f.typeLower="y",f.typeUpper="Y",l="height"}switch(this.opts.offCanvas.position){case"right":case"bottom":f.negative=!0,m=function(e){e>=s.$wndw[l]()-t.maxStartPos&&(v=1)}}switch(this.opts.offCanvas.position){case"left":break;case"right":f.open_dir="left",f.close_dir="right";break;case"top":f.open_dir="down",f.close_dir="up";break;case"bottom":f.open_dir="up",f.close_dir="down"}switch(this.opts.offCanvas.zposition){case"front":h=function(){return this.$menu}}var _=this.__valueOrFn(t.node,this.$menu,s.$page);"string"==typeof _&&(_=e(_));var b=new Hammer(_[0],this.opts[a].vendors.hammer);b.on("panstart",function(e){m(e.center[f.typeLower]),s.$slideOutNodes=h(),u=f.open_dir}),b.on(f.events+" panend",function(e){v>0&&e.preventDefault()}),b.on(f.events,function(e){if(r=e["delta"+f.typeUpper],f.negative&&(r=-r),r!=g&&(u=r>=g?f.open_dir:f.close_dir),g=r,g>t.threshold&&1==v){if(s.$html.hasClass(i.opened))return;v=2,d._openSetup(),d.trigger("open:start"),s.$html.addClass(i.dragging),w=n(s.$wndw[l]()*o[l].perc,o[l].min,o[l].max)}2==v&&(p=n(g,10,w)-("front"==d.opts.offCanvas.zposition?w:0),f.negative&&(p=-p),c="translate"+f.typeUpper+"("+p+"px )",s.$slideOutNodes.css({"-webkit-transform":"-webkit-"+c,transform:c}))}),b.on("panend",function(e){2==v&&(s.$html.removeClass(i.dragging),s.$slideOutNodes.css("transform",""),d[u==f.open_dir?"_openFinish":"close"]()),v=0})}function o(e,n,t,o){var s=this,p=e.data(r.parent);if(p){p=p.closest("."+i.panel);var c=new Hammer(e[0],s.opts[a].vendors.hammer),d=null;c.on("panright",function(e){d||(s.openPanel(p),d=setTimeout(function(){clearTimeout(d),d=null},s.conf.openingInterval+s.conf.transitionDuration))})}}var s="mmenu",a="drag";e[s].addons[a]={setup:function(){if(this.opts.offCanvas){var n=this.opts[a],i=this.conf[a];c=e[s].glbl,"boolean"==typeof n&&(n={menu:n,panels:n}),"object"!=typeof n&&(n={}),"boolean"==typeof n.menu&&(n.menu={open:n.menu}),"object"!=typeof n.menu&&(n.menu={}),"boolean"==typeof n.panels&&(n.panels={close:n.panels}),"object"!=typeof n.panels&&(n.panels={}),n=this.opts[a]=e.extend(!0,{},e[s].defaults[a],n),n.menu.open&&this.bind("setPage:after",function(){t.call(this,n.menu,i.menu,c)}),n.panels.close&&this.bind("initPanel:after",function(e){o.call(this,e,n.panels,i.panels,c)})}},add:function(){return"function"!=typeof Hammer||Hammer.VERSION<2?(e[s].addons[a].add=function(){},void(e[s].addons[a].setup=function(){})):(i=e[s]._c,r=e[s]._d,p=e[s]._e,void i.add("dragging"))},clickAnchor:function(e,n){}},e[s].defaults[a]={menu:{open:!1,maxStartPos:100,threshold:50},panels:{close:!1},vendors:{hammer:{}}},e[s].configuration[a]={menu:{width:{perc:.8,min:140,max:440},height:{perc:.8,min:140,max:880}},panels:{}};var i,r,p,c}(jQuery);